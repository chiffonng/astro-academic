---
import type { Author } from "@/lib/post-manager"
import Avatar from "@/components/base/Avatar.astro"

interface Props {
  author: Author
  class?: string
  "data-slot"?: string
  fallbackStyle?: "first-initial" | "all-initials"
  [key: string]: any
}

const {
  author,
  class: className,
  "data-slot": dataSlot = "author-avatar",
  fallbackStyle = "first-initial",
  ...imageProps
} = Astro.props

const authorName = author?.data?.name || author?.id || "Unknown"
const authorAvatar = author?.data?.avatar

// Default placeholder for users without avatars
const defaultAvatar =
  "https://cdn2.iconfinder.com/data/icons/gaming-and-beyond-part-2-1/80/User_gray-512.png"

// Generate fallback text based on style
const getFallback = (name: string, style: "first-initial" | "all-initials") => {
  if (style === "all-initials") {
    return name
      .split(" ")
      .map((word) => word[0])
      .filter((char) => /[A-Za-z]/.test(char))
      .join("")
      .toUpperCase()
  }
  return name.charAt(0).toUpperCase()
}
---

<Avatar
  src={authorAvatar || defaultAvatar}
  alt={authorName}
  fallback={getFallback(authorName, fallbackStyle)}
  class={className}
  data-slot={dataSlot}
  {...imageProps}
/>
